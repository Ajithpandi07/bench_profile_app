import 'package:cloud_firestore/cloud_firestore.dart';
import '../../domain/entities/health_metrics.dart';

class HealthMetricsModel extends HealthMetrics {
  const HealthMetricsModel({
    String source = 'none',
    required DateTime timestamp,
    int steps = 0,
    double? heartRate,
    double? weight,
    double? height,
    double? activeEnergyBurned,
    double? sleepAsleep,
    double? sleepAwake,
    double? water,
    double? bloodOxygen,
    double? basalEnergyBurned,
    int? flightsClimbed,
    double? distanceWalkingRunning,
    double? bodyFatPercentage,
    double? bodyMassIndex,
    double? heartRateVariabilitySdnn,
    double? bloodPressureSystolic,
    double? bloodPressureDiastolic,
    double? bloodGlucose,
    double? dietaryEnergyConsumed,
    double? sleepInBed,
    double? sleepDeep,
    double? sleepLight,
    double? sleepRem,
    double? restingHeartRate,
    double? caloriesBurned,
  }) : super(
          source: source,
          timestamp: timestamp,
          steps: steps,
          heartRate: heartRate,
          weight: weight,
          height: height,
          activeEnergyBurned: activeEnergyBurned,
          sleepAsleep: sleepAsleep,
          sleepAwake: sleepAwake,
          water: water,
          bloodOxygen: bloodOxygen,
          basalEnergyBurned: basalEnergyBurned,
          flightsClimbed: flightsClimbed,
          distanceWalkingRunning: distanceWalkingRunning,
          bodyFatPercentage: bodyFatPercentage,
          bodyMassIndex: bodyMassIndex,
          heartRateVariabilitySdnn: heartRateVariabilitySdnn,
          bloodPressureSystolic: bloodPressureSystolic,
          bloodPressureDiastolic: bloodPressureDiastolic,
          bloodGlucose: bloodGlucose,
          dietaryEnergyConsumed: dietaryEnergyConsumed,
          sleepInBed: sleepInBed,
          sleepDeep: sleepDeep,
          sleepLight: sleepLight,
          sleepRem: sleepRem,
          restingHeartRate: restingHeartRate,
          caloriesBurned: caloriesBurned,
        );

  factory HealthMetricsModel.empty(DateTime timestamp) {
    return HealthMetricsModel(
      source: 'none',
      timestamp: timestamp,
      steps: 0,
      heartRate: 0.0,
      weight: 0.0,
      height: 0.0,
      activeEnergyBurned: 0.0,
      sleepAsleep: 0.0,
      sleepAwake: 0.0,
      water: 0.0,
      bloodOxygen: 0.0,
      basalEnergyBurned: 0.0,
      flightsClimbed: 0,
      distanceWalkingRunning: 0.0,
      bodyFatPercentage: 0.0,
      bodyMassIndex: 0.0,
      heartRateVariabilitySdnn: 0.0,
      bloodPressureSystolic: 0.0,
      bloodPressureDiastolic: 0.0,
      bloodGlucose: 0.0,
      dietaryEnergyConsumed: 0.0,
      sleepInBed: 0.0,
      sleepDeep: 0.0,
      sleepLight: 0.0,
      sleepRem: 0.0,
      restingHeartRate: 0.0,
      caloriesBurned: 0.0,
    );
  }

  factory HealthMetricsModel.fromFirestore(DocumentSnapshot doc) {
    Map<String, dynamic> data = doc.data() as Map<String, dynamic>;
    return HealthMetricsModel(
      source: data['source'] ?? 'firestore',
      timestamp: (data['timestamp'] as Timestamp).toDate(),
      steps: data['steps'] ?? 0,
      heartRate: (data['heartRate'] as num?)?.toDouble(),
      weight: (data['weight'] as num?)?.toDouble(),
      height: (data['height'] as num?)?.toDouble(),
      activeEnergyBurned: (data['activeEnergyBurned'] as num?)?.toDouble(),
      sleepAsleep: (data['sleepAsleep'] as num?)?.toDouble(),
      sleepAwake: (data['sleepAwake'] as num?)?.toDouble(),
      water: (data['water'] as num?)?.toDouble(),
      bloodOxygen: (data['bloodOxygen'] as num?)?.toDouble(),
      basalEnergyBurned: (data['basalEnergyBurned'] as num?)?.toDouble(),
      flightsClimbed: data['flightsClimbed'],
      distanceWalkingRunning: (data['distanceWalkingRunning'] as num?)?.toDouble(),
      bodyFatPercentage: (data['bodyFatPercentage'] as num?)?.toDouble(),
      bodyMassIndex: (data['bodyMassIndex'] as num?)?.toDouble(),
      heartRateVariabilitySdnn: (data['heartRateVariabilitySdnn'] as num?)?.toDouble(),
      bloodPressureSystolic: (data['bloodPressureSystolic'] as num?)?.toDouble(),
      bloodPressureDiastolic: (data['bloodPressureDiastolic'] as num?)?.toDouble(),
      bloodGlucose: (data['bloodGlucose'] as num?)?.toDouble(),
      dietaryEnergyConsumed: (data['dietaryEnergyConsumed'] as num?)?.toDouble(),
      sleepInBed: (data['sleepInBed'] as num?)?.toDouble(),
      sleepDeep: (data['sleepDeep'] as num?)?.toDouble(),
      sleepLight: (data['sleepLight'] as num?)?.toDouble(),
      sleepRem: (data['sleepRem'] as num?)?.toDouble(),
      restingHeartRate: (data['restingHeartRate'] as num?)?.toDouble(),
      caloriesBurned: (data['caloriesBurned'] as num?)?.toDouble(),
    );
  }

  Map<String, dynamic> toFirestore() {
    return {
      'source': source,
      'timestamp': Timestamp.fromDate(timestamp),
      'steps': steps,
      'heartRate': heartRate,
      'weight': weight,
      'height': height,
      'activeEnergyBurned': activeEnergyBurned,
      'sleepAsleep': sleepAsleep,
      'sleepAwake': sleepAwake,
      'water': water,
      'bloodOxygen': bloodOxygen,
      'basalEnergyBurned': basalEnergyBurned,
      'flightsClimbed': flightsClimbed,
      'distanceWalkingRunning': distanceWalkingRunning,
      'bodyFatPercentage': bodyFatPercentage,
      'bodyMassIndex': bodyMassIndex,
      'heartRateVariabilitySdnn': heartRateVariabilitySdnn,
      'bloodPressureSystolic': bloodPressureSystolic,
      'bloodPressureDiastolic': bloodPressureDiastolic,
      'bloodGlucose': bloodGlucose,
      'dietaryEnergyConsumed': dietaryEnergyConsumed,
      'sleepInBed': sleepInBed,
      'sleepDeep': sleepDeep,
      'sleepLight': sleepLight,
      'sleepRem': sleepRem,
      'restingHeartRate': restingHeartRate,
      'caloriesBurned': caloriesBurned,
    }..removeWhere((key, value) => value == null); // Remove null values for cleaner Firestore documents
  }
}