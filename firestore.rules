rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ---------------------------------------------------------
    // EXISTING RULES: /bench_profile/{userId}/{platform}/{docId}
    // ---------------------------------------------------------
    match /bench_profile/{userId}/{platform}/{docId} {
      // Allow 'userreminders' alongside health metrics
      allow read, write: if request.auth != null
        && request.auth.uid == userId
        && (platform == 'healthmetricesandroid' || platform == 'healthmetriceios' || platform == 'userreminders');

      // Nested subcollections
      match /{subCollection}/{subDocId} {
        allow read, write: if request.auth != null
          && request.auth.uid == userId
          && (platform == 'healthmetricesandroid' || platform == 'healthmetriceios')
          && subCollection == 'health_metrics';
      }
    }

    // ---------------------------------------------------------
    // NEW RULES: /bench_profile/{userId}/...
    // ---------------------------------------------------------
    match /bench_profile/{userId}/user_foods/{document} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    match /bench_profile/{userId}/user_meals/{document} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    match /bench_profile/{userId}/meal_logs/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ---------------------------------------------------------
    // NEW RULE: Allow Hydration logging in /users collection
    // ---------------------------------------------------------
    match /users/{userId}/userhydration/{document} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ---------------------------------------------------------
    // Default Deny
    // ---------------------------------------------------------
    match /{document=**} {
      allow read: if false;
      allow write: if false;
    }
  }
}